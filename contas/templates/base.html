<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayFlow</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Estilos para parcelamento */
        .parcela-group {
            border-left: 3px solid #0d6efd !important;
        }

        .parcela-group:first-of-type {
            border-top: 1px solid #dee2e6;
        }

        .parcela-group+tr:not(.parcela-group) {
            border-top: 2px solid #6c757d;
        }

        /* Mobile-first responsividade */
        @media (max-width: 768px) {
            .container {
                padding-left: 10px;
                padding-right: 10px;
            }

            .navbar-brand span {
                font-size: 1.1em !important;
            }

            .btn-lg {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }

            .card-body {
                padding: 1rem;
            }

            .table-responsive {
                font-size: 0.85rem;
            }

            .toast {
                min-width: 300px !important;
                max-width: 90vw;
            }

            .footer-site {
                font-size: 0.9rem;
                padding: 0.75rem !important;
            }
        }

        @media (max-width: 576px) {
            .navbar-brand span {
                font-size: 1em !important;
            }

            .btn {
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
            }

            .card {
                margin-bottom: 1rem;
            }

            .table {
                font-size: 0.8rem;
            }

            .table th,
            .table td {
                padding: 0.5rem 0.25rem;
            }

            .toast {
                min-width: 280px !important;
                max-width: 95vw;
            }
        }

        /* Dark mode */
        body.dark-mode {
            background-color: #181a1b !important;
            color: #e0e0e0 !important;
        }

        body.dark-mode .bg-light {
            background-color: #23272b !important;
            color: #e0e0e0 !important;
        }

        body.dark-mode .card,
        body.dark-mode .navbar,
        body.dark-mode .footer-site {
            background-color: #23272b !important;
            color: #e0e0e0 !important;
        }

        body.dark-mode .table {
            color: #e0e0e0;
        }

        body.dark-mode .border-top,
        body.dark-mode .border {
            border-color: #444 !important;
        }

        body.dark-mode .btn-primary {
            background-color: #0d6efd;
            border-color: #0d6efd;
        }

        body.dark-mode .btn-danger {
            background-color: #dc3545;
            border-color: #dc3545;
        }

        body.dark-mode .btn-outline-secondary {
            color: #e0e0e0;
            border-color: #888;
        }

        body.dark-mode .form-control,
        body.dark-mode .form-select {
            background-color: #23272b;
            color: #e0e0e0;
            border-color: #444;
        }

        body.dark-mode .form-control:focus,
        body.dark-mode .form-select:focus {
            background-color: #23272b;
            color: #fff;
        }

        body.dark-mode .footer-site {
            background-color: #181a1b !important;
            color: #e0e0e0 !important;
            border-top: 1px solid #444 !important;
        }

        /* Melhorias para touch */
        .btn {
            min-height: 44px;
            touch-action: manipulation;
        }

        .form-control,
        .form-select {
            min-height: 44px;
            font-size: 16px;
            /* Evita zoom no iOS */
        }

        /* Melhor espaçamento para mobile */
        .mb-4 {
            margin-bottom: 1.5rem !important;
        }

        @media (max-width: 768px) {
            .mb-4 {
                margin-bottom: 1rem !important;
            }
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center gap-2" href="/contas/">
                <i class="fas fa-money-check-alt"></i>
                <span style="font-weight:700; letter-spacing:1px; font-size:1.3em;">PayFlow</span>
            </a>

            <div class="d-flex align-items-center gap-2">
                {% if user.is_authenticated %}
                <a href="{% url 'historico_quitadas' %}" class="btn btn-outline-light btn-sm" title="Histórico de contas quitadas">
                    <i class="fas fa-history me-1"></i>
                    <span class="d-none d-md-inline">Histórico</span>
                </a>
                {% endif %}
                <button id="toggle-theme" class="btn btn-outline-secondary btn-sm" title="Alternar tema">
                    <i class="fas fa-moon"></i>
                </button>

                {% if user.is_authenticated %}
                <form action="/accounts/logout/" method="post" style="display:inline;"
                    onsubmit="return confirmarLogout();">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger btn-sm fw-bold shadow-sm" id="btnSair">
                        <i class="fas fa-sign-out-alt me-1"></i>
                        <span class="d-none d-sm-inline">Sair</span>
                    </button>
                </form>
                {% else %}
                <a class="btn btn-primary btn-sm" href="/accounts/login/">
                    <i class="fas fa-sign-in-alt me-1"></i>
                    <span class="d-none d-sm-inline">Entrar</span>
                </a>
                {% endif %}
            </div>
        </div>
    </nav>
    <div class="container">
        {% block content %}{% endblock %}
    </div>

    <!-- Toasts para mensagens Django -->
    <div aria-live="polite" aria-atomic="true" class="position-fixed top-0 start-50 translate-middle-x p-3"
        style="z-index: 1080; width: 100%; max-width: 400px;">
        {% if messages %}
        {% for message in messages %}
        <div class="toast align-items-center border-0 mb-2 fade w-100" role="alert" aria-live="assertive"
            aria-atomic="true" data-bs-autohide="true" data-bs-delay="5000">
            <div class="d-flex">
                <div class="toast-body d-flex align-items-center gap-2 flex-grow-1">
                    {% if message.tags == 'success' %}
                    <i class="fas fa-check-circle text-success fs-5"></i>
                    {% elif message.tags == 'error' or message.tags == 'danger' %}
                    <i class="fas fa-times-circle text-danger fs-5"></i>
                    {% elif message.tags == 'warning' %}
                    <i class="fas fa-exclamation-triangle text-warning fs-5"></i>
                    {% else %}
                    <i class="fas fa-info-circle text-info fs-5"></i>
                    {% endif %}
                    <span class="flex-grow-1">{{ message }}</span>
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                    aria-label="Fechar"></button>
            </div>
        </div>
        {% endfor %}
        {% endif %}
    </div>
    <footer class="footer-site bg-light text-center py-3 mt-5 border-top">
        <div class="d-flex flex-column flex-sm-row justify-content-center align-items-center gap-2">
            <span>Desenvolvido por <strong>Daniel Rodrigues</strong></span>
            <a href="https://wa.me/5592991841255" target="_blank" class="text-success text-decoration-none"
                title="Fale comigo no WhatsApp">
                <i class="fab fa-whatsapp" style="font-size:1.2em;"></i>
                <span class="ms-1 d-none d-sm-inline">WhatsApp</span>
            </a>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            if (document.querySelector('input[name="vencimento"]')) {
                flatpickr('input[name="vencimento"]', {
                    dateFormat: 'Y-m-d',
                    locale: 'pt'
                });
            }

            // Alternância de tema dark/light
            function setTheme(dark) {
                if (dark) {
                    document.body.classList.add('dark-mode');
                    localStorage.setItem('theme', 'dark');
                    const btn = document.getElementById('toggle-theme');
                    if (btn) btn.innerHTML = '<i class="fas fa-sun"></i>';
                } else {
                    document.body.classList.remove('dark-mode');
                    localStorage.setItem('theme', 'light');
                    const btn = document.getElementById('toggle-theme');
                    if (btn) btn.innerHTML = '<i class="fas fa-moon"></i>';
                }
            }
            setTheme(localStorage.getItem('theme') === 'dark');
            const toggleBtn = document.getElementById('toggle-theme');
            if (toggleBtn) {
                toggleBtn.onclick = function () {
                    setTheme(!document.body.classList.contains('dark-mode'));
                };
            }
        });

        // Inicializa todos os toasts do Bootstrap com animação
        const toastElList = [].slice.call(document.querySelectorAll('.toast'));
        toastElList.map(function (toastEl) {
            toastEl.classList.add('show');
            return new bootstrap.Toast(toastEl, { delay: 5000 }).show();
        });

        // Confirmação de logout
        function confirmarLogout() {
            return confirm('Tem certeza que deseja sair da sua conta?');
        }
    </script>
</body>

</html>